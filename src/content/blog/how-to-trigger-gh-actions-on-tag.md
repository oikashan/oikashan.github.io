---
draft: false
title: "GitHub Actions - How to run a workflow on tag push"
snippet: "You learn a thousand things everyday, make sure you write about the ones you wanna remember, like this one."
image: {
    src: "./images/github-actions-awesome.jpg",
    alt: "Octocat and Groot reading a book together",
}
publishDate: "2023-12-18 00:00"
category: "Tutorial"
author: "Kashan Ahmad"
tags: [CI/CD, GitHub, GitHub Actions]
---

This is more like a note to self than a blog post, but I'm sure it'll help someone out there. So, I was working on this sweet little JS Library boilerplate called [Crust](https://github.com/sassywares/crust) and I wanted to create a release on GitHub whenever I push a git tag as well as build and publish the package to NPM. Here's how I got it done.

Firstly, I created a workflow file in `.github/workflows` and named it `release.yml`. Then, I added the following code to it.

```yml
name: Crusty

on:
  push:
    tags:
      - "*"

jobs:
  create-release:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: 18
          registry-url: https://registry.npmjs.org/
      - uses: actions/create-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          tag_name: ${{ github.ref }}
          release_name: Crust@v${{ github.ref }}
          draft: false
          prerelease: false

  publish-to-npm:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: 18
          registry-url: https://registry.npmjs.org/
      # Install deps
      - run: npm i

      # Prepare release
      - run: npm run release.prepare

      # Publish to NPM
      - run: npm run release.publish
        env:
          # This is the NPM token used to publish the package to NPM, you only need this if you've enabled publishing with access tokens. Read more about this [here](https://docs.npmjs.com/about-access-tokens). Once you have the token in NPM, you'll have to add it as a secret in the GitHub repository. Read more about GitHub secrets [here](https://docs.github.com/en/actions/reference/encrypted-secrets).
          NODE_AUTH_TOKEN: ${{ secrets.NODE_AUTH_TOKEN }}
```

This watches for a new git tag to be pushed and then creates a release on GitHub and then builds and publishes the package to NPM. Let me break it down.

```yml
name: Crusty
```

This is the name of the workflow, you can name it whatever you want.

```yml
on:
  push:
    tags:
      - "*"
```

This is the event that triggers the workflow. In this case, it's a push event on a tag. The `*` means that it'll trigger on any tag push. Say you wanna trigger the workflow only on a tag push that starts with `v`, you can do that like this.

```yml
on:
  push:
    tags:
      - "v*"
```

```yml
jobs:
  create-release:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: 18
          registry-url: https://registry.npmjs.org/
      - uses: actions/create-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          tag_name: ${{ github.ref }}
          release_name: Crust@v${{ github.ref }}
          draft: false
          prerelease: false
```

This is the first job that creates a release on GitHub. It uses the `actions/checkout` action to checkout the repository, the `actions/setup-node` action to setup Node.js, and the `actions/create-release` action to create a release on GitHub. The `GITHUB_TOKEN` is a secret that's automatically generated by GitHub and is available in every repository. The `tag_name` is the name of the tag that triggered the workflow, the `release_name` is the name of the release that'll be created on GitHub, the `draft` is whether the release should be a draft or not, and the `prerelease` is whether the release should be a prerelease or not.

```yml
publish-to-npm:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: 18
          registry-url: https://registry.npmjs.org/
      # Install deps
      - run: npm i

      # Prepare release
      - run: npm run release.prepare

      # Publish to NPM
      - run: npm run release.publish
        env:
          # This is the NPM token used to publish the package to NPM, you only need this if you've enabled publishing with access tokens. Read more about this [here](https://docs.npmjs.com/about-access-tokens). Once you have the token in NPM, you'll have to add it as a secret in the GitHub repository. Read more about GitHub secrets [here](https://docs.github.com/en/actions/reference/encrypted-secrets).
          NODE_AUTH_TOKEN: ${{ secrets.NODE_AUTH_TOKEN }}
```

This is the second job that builds and publishes the package to NPM. It uses the `actions/checkout` action to checkout the repository, the `actions/setup-node` action to setup Node.js, and then runs a few commands to build and publish the package to NPM. The `NODE_AUTH_TOKEN` is a secret that's generated by NPM and is used to publish the package to NPM. You can read more about it [here](https://docs.npmjs.com/about-access-tokens). Once you have the token in NPM, you'll have to add it as a secret in the GitHub repository. Read more about GitHub secrets [here](https://docs.github.com/en/actions/reference/encrypted-secrets).

And that's it, that's how you run a workflow on tag push. Until next time, keep solving problems, keep getting better, and keep moving forward.

- [Crust](https://github.com/sassywares/crust)
- [Sassywares](https://sassywares.com/)
- [Yours Truly](https://kashanahmad.me/)